<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="components/jquery/dist/jquery.js"></script>
<script src="components/d3/d3.js"></script>
<script src="components/d3-cloud/d3.layout.cloud.js"></script>
<style type="text/css">
    text{
        cursor: pointer;
    }
    body{
        text-align: center;
        background-color: #292929;
    }
</style>
<script>

    var username = window.location.hash.replace(/^#/,'');
    var ghUrl = 'https://api.github.com/users/%user%/repos'
            .replace('%user%', username);

    Array.prototype.removeValue = function(val) {
        do{
            var position = this.indexOf(val);
            if ( position>-1 ) this.splice(position, 1);
        }while(position>-1);
    };

    Array.prototype.countValue = function(val) {
        var position = -1;
        var found = 0;
        do{
            position = this.indexOf(val, position+1);
            if ( position>-1 ) found++;
        }while(position>-1);
        return found;
    };

    $.get(ghUrl, function(repos){
        var words = [];
        repos.forEach(function(repo){
            words = words
                    .concat((''+repo.name).toLowerCase().replace(/[^a-z0-9\s]+/ig,' ').split(/[\s-]/))
                    .concat((''+repo.description).toLowerCase().replace(/[^a-z0-9\s]+/ig,' ').split(/[\s-]/))
                    .concat((''+repo.language).toLowerCase().replace(/[^a-z0-9\s]+/ig,' ').split(/[\s-]/));
        });

        [
            '',
            'a',
            'of',
            'so',
            'in',
            'see',
            'to',
            'your',
            'or',
            'and',
            'via',
            'the',
            'do',
            'i',
            'with',
            'for',
            'an',
            'is',
            'it',
            'for'
        ].forEach(function(exclude){
            words.removeValue(exclude);
                });

        var unqiWords = [];
        var cloudWords = [];
        words.forEach(function(word){
            if(unqiWords.indexOf(word)==-1){
                unqiWords.push(word)
                cloudWords.push(
                        { text:word, count: words.countValue(word) }
                );
            }
        });
        showCloud(cloudWords);
        $('body').on('click', function(ev){
            if($(ev.target).is('text') ) {
                var word = ev.target.innerHTML;
                window.open('https://github.com/search?q=user%3A'+username+'+'+word)
            }
        });
    });

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function getRandomArbitrary(min, max) {
        return Math.random() * (max - min) + min;
    }

    var showCloud = function(words){

        var fill = d3.scale.category20();

        d3.layout.cloud().size([1200, 800])
                .words(words.map(function(d) {
                    var k = 1/(d.count+getRandomArbitrary(0,1));
                    k = k*50;
                    return {text: d.text, size: k};
                }))
                .padding(5)
                .rotate(function() { return ~~(Math.random() * 2) * 90; })
                .font("Impact")
                .fontSize(function(d) { return d.size; })
                .on("end", draw)
                .start();

        function draw(words) {
            d3.select("body").append("svg")
                    .attr("width", 1200)
                    .attr("height", 800)
                    .append("g")
                    .attr("transform", "translate(600,400)")
                    .selectAll("text")
                    .data(words)
                    .enter().append("text")
                    .style("font-size", function(d) { return d.size + "px"; })
                    .style("font-family", "Impact")
                    .style("fill", function(d, i) { return fill(i); })
                    .attr("text-anchor", "middle")
                    .attr("transform", function(d) {
                        return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                    })
                    .text(function(d) { return d.text; });
        }
    };

</script>
